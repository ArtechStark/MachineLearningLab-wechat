![](http://ww1.sinaimg.cn/large/e323d644ly1g0bsth7hjhj20rv09yjuy.jpg)
在计算机视觉(Computer Vision)中，二维卷积(2D CNNs)是非常重要的。常用的图像分类、目标检测、图像分割模型都用到了二维卷积。一维卷积相对小众一点，但是在某些问题上也具有重要的作用。本文梳理了一下一维卷积的原理和应用，并提供keras、pytorch代码，供大家参考。

# NiN、一维、二维、三维卷积的原理
不同维度的卷积，本质的计算方法是一样的，区别在于输入数据和卷积核(filter)的维度不一样，当然输出数据的维度也相应改变。
## NiN（1x1卷积核）
![](http://ww1.sinaimg.cn/large/e323d644ly1g0by0z9e8tj20ji058q3t.jpg)
![](http://ww1.sinaimg.cn/large/e323d644ly1g0by2lpiwnj213t0btn0z.jpg)
- **首先区分两个概念：一维卷积和1x1卷积核对应的卷积(NiN)**，前者的卷积核是一维的向量，后者的卷积核是一个标量，因此后者其实可以称作“零维卷积”（文献中好像没这么说的）。
- 1x1卷积核的作用
	- 降维/升维
	- 增加非线性
	- 跨通道信息交互
- 1x1卷积核的应用
	- ResNet
	![](http://ww1.sinaimg.cn/large/e323d644ly1g0by7osupaj20nr08wwgx.jpg)

	- GoogLeNet
    
    ![](http://ww1.sinaimg.cn/large/e323d644ly1g0byhuu31yj20gv08sgm7.jpg)
    
    <center>带有维度约减的inception模块</center>
## 一维卷积
- 一维卷积的卷积核是一个长度为n的一维向量。下面给出一个简单的一维卷积的python代码。

```python
import numpy as np
input = np.array([1, 0, 1, 0, 1, 0, 1, 0, 1, 0])
kernel = np.array([1, -1, 0])
output = np.array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0])

# Output array
for ii in range(8):
    output[ii] = (kernel * input[ii:ii+3]).sum()

# Print output array
print(output)
#输出[1 -1 1 -1 1 -1 0 0]
```

## 二维卷积
![](http://ww1.sinaimg.cn/large/e323d644ly1g0btj8s7grj20ab04wmxv.jpg)

二维卷积是最常用的卷积方法，它的输入输出分别是：
- 输入数据（图片）的维度是 [h,w,c]，卷积核维度为 [n,n,c]，num_filter代表卷积核个数，strie = s, padding = p，那么输出数据的维度为[$\frac{h + 2p - f}{s} + 1 $, $\frac{h + 2p - f}{s} + 1 $, num_filter]
	- 卷积核的通道数等于输入图片的通道数
	- 卷积核的个数等于输出图片的通道数
- 例子一：如下图，输入数据维度为[7,7,1]，卷积核维度为[3,3,1]，1个卷积核, stride = 1, padding = 0, 则输出图片的高和宽为
$$ h' = \frac{7+2*0-3}{1} + 1 = 5$$
$$ w' = \frac{7+2*0-3}{1} + 1 = 5$$

![](http://ww1.sinaimg.cn/large/e323d644ly1g0bx7f19zuj20de06b0sl.jpg)

- 例子二：上例中，仅仅把stride由1修改为2。则输出图片的高和宽为
$$ h' = \frac{7+2*0-3}{2} + 1 = 3$$
$$ w' = \frac{7+2*0-3}{2} + 1 = 3$$

![](http://ww1.sinaimg.cn/large/e323d644ly1g0bx807mogj20cw06j3yd.jpg)
## 三维卷积
- **谈到三维卷积，需要明确一点：多通道的二维卷积核[h,w,c]并不是三维卷积**。n维卷积指的是卷积运算用的是n维的卷积核，而在讨论核的维度时，是不把channel维加进去的。因为卷积核的维度指的是进行滑动窗口的维度，而滑窗操作是不在channel维度上进行的。每个channel共享一个滑窗位置，且不同channel上的卷积核权重是独立的。**三维卷积核是[d,h,w,c]。**
- 三维卷积的输出计算方法同二维卷积，只是多了一个维度
- 三维卷积通常用于
	- 医学影像数据，如CT影像
	- 视频处理领域，检测动作及人物行为

# 一维卷积在时间序列数据分析中的应用

# 如何使用一维卷积（keras、pytorch代码）
学习的最终目的是为了应用，如果你有一个时间序列数据要处理，比如机械领域的故障诊断或状态预测等。下面分别给出keras和pytorch的代码。

keras版本

```python
from keras.models import Sequential
from keras.layers import Dense, Dropout
from keras.layers import Embedding
from keras.layers import Conv1D, GlobalAveragePooling1D, MaxPooling1D

model = Sequential()
model.add(Conv1D(64, 3, activation='relu', input_shape=(seq_length, 100)))
model.add(Conv1D(64, 3, activation='relu'))
model.add(MaxPooling1D(3))
model.add(Conv1D(128, 3, activation='relu'))
model.add(Conv1D(128, 3, activation='relu'))
model.add(GlobalAveragePooling1D())
model.add(Dropout(0.5))
model.add(Dense(1, activation='sigmoid'))

model.compile(loss='binary_crossentropy',
              optimizer='rmsprop',
              metrics=['accuracy'])

model.fit(x_train, y_train, batch_size=16, epochs=10)
score = model.evaluate(x_test, y_test, batch_size=16)
```
# 参考资料
- DeepLearning.ai视频教程 (https://www.coursera.org/lecture/convolutional-neural-networks/networks-in-networks-and-1x1-convolutions-ZTb8x)
- Going Deeper with Convolutions（https://arxiv.org/pdf/1409.4842.pdf）
- 

